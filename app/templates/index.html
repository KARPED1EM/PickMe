<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Pick Me</title>
    <link rel="icon" type="image/svg+xml" href="{{ url_path_for('static', path='icons/icon.svg') }}">
    <link rel="stylesheet" href="{{ url_path_for('static', path='css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_path_for('static', path='css/style.css') }}">
</head>
<body class="app-body">
<div class="unsupported-overlay" id="unsupported-overlay">
    <div class="unsupported-message">
        <h1>仅支持桌面端横屏访问</h1>
        <p>此应用仅适用于桌面设备的横屏模式。请使用桌面浏览器或将设备切换至横屏模式后访问。</p>
    </div>
</div>
<div class="app-backdrop"></div>
<main class="app-main container-xxl px-3 px-lg-4 py-4">
    <div class="app-grid">
        <div class="app-primary">
        <section class="glass result-card p-4">
            <div class="result-grid">
            <div class="result-main">
                <div class="result-primary">
                <div class="result-name-shell">
                    <div id="result-name" class="result-name">--</div>
                </div>
                <div id="result-note" class="result-note">等待抽取...</div>
                </div>
            </div>
            <div class="result-side">
                <div class="result-meta">
                <div class="result-meta-actions">
                    <button id="class-switcher" type="button" class="btn btn-ghost class-switcher">
                    <span class="class-switcher-label" id="class-switcher-label">--</span>
                    <span class="class-switcher-icon" aria-hidden="true">
                        <svg viewBox="0 0 16 16" fill="none">
                        <path d="M4 6l4 4 4-4" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                    </span>
                    </button>
                    <button id="settings-button" type="button" class="btn btn-ghost settings-button" title="设置">
                    <span class="settings-button-icon" aria-hidden="true">
                        <svg viewBox="0 0 16 16" fill="currentColor">
                        <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52zm-1.796 4.41a3.248 3.248 0 1 1 0 6.496 3.248 3.248 0 0 1 0-6.496z" fill-rule="evenodd" clip-rule="evenodd"></path>
                        <path d="M8 6.754a1.246 1.246 0 1 0 0 2.492 1.246 1.246 0 0 0 0-2.492z"></path>
                        </svg>
                    </span>
                    <span class="visually-hidden">设置</span>
                    </button>
                </div>
                <div class="result-stats">
                    <div class="result-stat">
                    <span class="result-stat-label">总人数</span>
                    <span id="stat-total" class="result-stat-value">0</span>
                    </div>
                    <div class="result-stat">
                    <span class="result-stat-label">冷却中</span>
                    <span id="stat-cooling" class="result-stat-value">0</span>
                    </div>
                    <div class="result-stat">
                    <span class="result-stat-label">可抽取</span>
                    <span id="stat-available" class="result-stat-value">0</span>
                    </div>
                </div>
                </div>
                <div class="result-controls-wrapper">
                <div class="controls-left">
                    <div class="batch-count-field d-none" data-batch-field>
                    <label class="form-label" for="batch-count">抽取人数</label>
                        <div class="input-group input-group-sm batch-input">
                            <input id="batch-count" type="number" class="form-control" min="1" max="20" step="1" autocomplete="off" inputmode="numeric">
                            <span class="input-group-text">人</span>
                        </div>
                    </div>
                </div>
                <div class="controls-right">
                    <div class="result-controls">
                    <div class="form-check form-switch ignore-switch switch-ghost">
                        <input class="form-check-input" type="checkbox" id="ignore-cooldown">
                        <label class="form-check-label" for="ignore-cooldown">忽略冷却时间</label>
                    </div>
                    <div class="result-action">
                        <div class="result-action-split result-mode-control" data-mode-control>
                        <button id="pick-action" type="button" class="btn btn-accent result-action-button">
                            <span class="result-action-text">开始</span>
                            <span id="result-mode-display" class="result-action-mode">抽取一人</span>
                        </button>
                        <button id="pick-mode-toggle" type="button" class="btn btn-accent result-action-toggle" aria-haspopup="true" aria-expanded="false" aria-controls="result-mode-menu">
                            <span class="result-action-icon" aria-hidden="true">
                            <svg viewBox="0 0 16 16" fill="none">
                                <path d="M5 6l3 4 3-4" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path>
                            </svg>
                            </span>
                        </button>
                        </div>
                        <div id="result-mode-menu" class="result-mode-menu" hidden>
                        <button type="button" class="result-mode-option" data-mode-value="single" data-mode-label="抽取一人">抽取一人</button>
                        <button type="button" class="result-mode-option" data-mode-value="batch" data-mode-label="抽取多人">抽取多人</button>
                        <button type="button" class="result-mode-option" data-mode-value="group" data-mode-label="抽取小组">抽取小组</button>
                        </div>
                    </div>
                    </div>
                </div>
                </div>
            </div>
            </div>
        </section>

        <div class="app-lists">
            <section class="list-section">
            <div class="glass list-card p-4 h-100">
                <div class="list-header">
                <div>
                    <h2 class="list-title">全部学生</h2>
                    <p class="list-subtitle">右键列表项可以快速操作</p>
                </div>
                <div class="list-toolbar">
                    <div class="search-box">
                    <span class="search-icon" aria-hidden="true">
                        <svg viewBox="0 0 24 24" fill="none">
                        <path d="M21 21l-4.35-4.35M19 11a8 8 0 1 1-16 0 8 8 0 0 1 16 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
                        </svg>
                    </span>
                    <input id="student-search" type="search" class="form-control" placeholder="搜索姓名 / 小组" autocomplete="off">
                    </div>
                    <button id="add-student" class="btn btn-outline-light toolbar-btn">添加学生</button>
                </div>
                </div>
                <ul id="student-list" class="student-list slim-scroll"></ul>
            </div>
            </section>
            <section class="list-section">
            <div class="glass list-card p-4 h-100">
                <div class="list-header">
                <div>
                    <h2 class="list-title">冷却队列</h2>
                    <p class="list-subtitle">右键列表项可以快速操作</p>
                </div>
                <div class="cooldown-toolbar">
                    <button id="cooldown-display" type="button" class="btn btn-ghost">
                    冷却 <span id="cooldown-value">0</span> 天
                    </button>
                    <button id="clear-cooldown" class="btn btn-ghost">清空冷却</button>
                </div>
                </div>
                <ul id="cooldown-list" class="student-list slim-scroll"></ul>
            </div>
            </section>
        </div>
        </div>

        <aside class="app-history">
        <section class="glass history-card p-4 h-100">
            <div class="list-header history-header">
            <div>
                <h2 class="list-title">点名历史</h2>
                <p class="list-subtitle">右键列表项可以快速操作</p>
            </div>
            </div>
            <div id="history-list" class="history-panel slim-scroll">
            <div class="history-empty" data-history-empty>暂无历史记录</div>
            <div id="history-groups" class="history-groups"></div>
            </div>
        </section>
        </aside>
    </div>
</main>

<div id="context-menu" class="context-menu d-none"></div>
<div id="modal-root" class="modal-root d-none"></div>
<div id="toast-stack" class="toast-stack" aria-live="polite" aria-atomic="false"></div>

<script>
    window.__APP_INITIAL_DATA__ = {{ initial_data|safe }};
    window.__APP_STORAGE_MODE__ = {{ storage_mode|tojson }};
    window.__APP_STORAGE_LOCATION__ = {{ user_data_path|tojson }};
    window.__APP_META__ = {{ app_meta|tojson }};
</script>
<script src="{{ url_path_for('static', path='js/app.js') }}"></script>
</body>
</html>
